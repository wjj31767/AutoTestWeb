# 登录功能自动化测试脚本

## 概述

此脚本用于自动化测试登录功能，确保在每次修改代码后，登录功能仍然正常工作，不会出现CSRF错误。

## 修复的问题

1. **添加了axios导入**：在`frontend/src/api/axios.js`中添加了缺失的axios导入语句
2. **配置CSRF可信来源**：在`AutoTestWeb/settings.py`中添加了`CSRF_TRUSTED_ORIGINS = ['http://localhost:5173']`配置

## 使用方法

1. 确保后端服务器正在运行（Django开发服务器）
2. 运行以下命令执行测试脚本：

```bash
cd frontend
node test_login_csrf.js
```

## 测试脚本功能

- 自动向登录接口发送请求，使用测试用户`test/test@123`
- 验证登录响应是否成功（状态码200）
- 检查是否有CSRF错误
- 尝试访问环境列表接口验证认证是否有效
- 将详细测试结果保存到`login_test.log`文件

## 测试结果说明

- 测试成功：脚本会输出`✅ 登录测试成功！没有CSRF错误。`，并以状态码0退出
- 测试失败：脚本会输出错误信息，并以非零状态码退出
- 详细结果：所有测试详情都会保存到`login_test.log`文件，包括：
  - 时间戳
  - 测试成功/失败状态
  - 登录响应详情（状态码、数据、头部信息）
  - 环境列表接口访问结果

## 注意事项

1. 确保测试用户`test/test@123`存在于系统中
2. 此脚本主要测试CSRF保护和登录功能，不测试其他业务逻辑
3. 如测试失败，请检查：
   - Django服务器是否正在运行
   - `CSRF_TRUSTED_ORIGINS`配置是否正确
   - axios配置是否正确

## 自动化集成

可以将此脚本集成到CI/CD流程中，确保每次代码变更后都自动运行测试，提前发现CSRF相关问题。