# 芯片验证防护网软件详细设计文档

## 一、文档概述

### 1.1 文档目的

本文档旨在详细定义芯片验证防护网软件的架构设计、模块功能、接口规范、数据结构、业务流程及部署方案，为软件开发团队提供明确的技术指导，确保开发过程符合芯片验证的功能安全与可靠性需求，同时为后续的测试、维护和迭代提供依据。

### 1.2 文档范围

覆盖软件从需求映射到最终部署的全技术链路，包括核心功能模块（验证任务管理、漏洞检测、防护策略执行、结果分析）、非功能需求实现（性能、安全性、可扩展性）、接口设计（内部模块间、与外部工具 / 芯片的交互）、数据存储与流转、异常处理及部署方案，不包含芯片硬件设计细节及第三方验证工具的内部实现。

### 1.3 目标读者

软件开发工程师（后端 / 前端）、测试工程师、系统集成工程师、芯片验证工程师、技术架构师及项目管理人员。

## 二、需求分析与映射

### 2.1 功能需求映射

将芯片验证防护网的核心需求拆解为具体的软件功能点，明确需求与模块的对应关系，确保无需求遗漏。



| 需求类别     | 需求描述                                              | 对应软件功能模块   | 优先级 |
| -------- | ------------------------------------------------- | ---------- | --- |
| 环境管理     | 支持创建、编辑、删除验证环境（如FPGA和Socket和QEMU以及产品版），环境连接如telnet链接只需提供IP和端口，redirect连接需提供IP用户密码以及柜框槽，环境如需操作ftp需提供ftp所需掩码配置 | 环境管理模块     | 高   |
| 测试套管理     | 支持创建、编辑、删除测试套，对于一个用户可以有多个测试套，支持用户复制他人或自己的测试套 | 测试套管理模块     | 高   |
| 模块管理     | 支持创建、编辑、删除模块，每个模块对应多个特性，每个特性对应多个测试用例 | 模块管理模块     | 高   |
| 特性与测试用例管理 | 特性由代码仓结构自动获取，用例也根据代码仓结构自动获取          | 特性与测试用例管理模块 | 高   |
| 用例执行管理     | 支持测试套的立即执行与定时执行，支持手动暂停、继续、终止执行，支持勾选从特定分支出包并自动换包，支持上传本地包自动换包 | 用例执行管理模块     | 高   |
| 用例结果管理     | 按测试套展示执行开始时间，执行时间，执行结束时间，执行状态，执行结果日志 | 用例执行结果管理模块     | 高   |
### 2.2 非功能需求映射

明确软件的性能、安全性、可扩展性等非功能需求，转化为可落地的技术指标。



| 非功能类别 | 需求描述                                     | 技术指标                 | 实现模块 / 方案                 |
| ----- | ---------------------------------------- | -------------------- | ------------------------- |
| 性能    | 考虑环境如果受多用例同时执行易发生错误，同一环境只支持一个任务执行，不同环境可并行执行        | -                    | 用例执行模块（异步处理）、任务调度模块（资源隔离） |
| 安全性   | 敏感数据（如验证用例）加密存储，用户操作日志留存≥6 个月       | AES-256 加密、日志归档机制    | 数据存储模块、日志管理模块             |
| 可扩展性  | 支持新增芯片的验证适配，模块新增无需修改核心代码 | 插件化架构                | 核心框架模块                    |
| 可靠性   | 软件无故障运行时间（MTBF）≥1000 小时，异常场景下数据不丢失       | 数据备份（定时 + 增量）、异常恢复机制 | 数据存储模块、异常处理模块             |

## 三、总体架构设计

### 3.1 架构分层

采用分层架构设计，降低模块耦合度，提升可维护性与可扩展性，各层职责清晰且自上而下依赖。



| 架构层级  | 核心职责                                                      | 包含模块                                                         | 技术选型（重点适配 Django+Docker）                                                                                                                                        |
| ----- | --------------------------------------------------------- | ------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 表现层   | 提供用户交互界面与外部系统接入入口；负责数据展示、操作转发、权限校验前置                      | 前端交互模块、API 网关模块                                              | 前端（Vue3+Element Plus）、后端 API（Django REST Framework，替代原 Spring Cloud Gateway，统一接口入口）                                                                             |
| 业务逻辑层 | 基于 Django 实现核心业务流程；处理业务规则、权限判断、用例执行调度                     | 环境管理模块、测试套管理模块、模块管理模块、特性与测试用例管理模块、用例执行管理模块、用例执行结果管理模块        | 后端（Python 3.10+，Django 4.2+；DRF 实现 API；Celery 实现异步任务如用例执行 / 数据清理）、定时任务（Celery Beat，替代原 Quartz）                                                                  |
| 数据层   | 所有数据存储在 Docker 容器内，通过 Django ORM 操作；实现 Docker 数据卷空间不足自动清理 | 数据存储模块（Docker 内数据库 / 文件）、数据加密模块、Docker 数据清理模块、代码仓交互模块、文件存储模块 | 数据库（Docker 内 MySQL 8.0，通过 Django ORM 操作）、缓存（Docker 内 Redis 7.0，Django Cache 适配）、文件存储（Docker 数据卷挂载，替代原 MinIO）、Git 客户端（Python-GitLab/JGit，对接代码仓）                  |
| 基础设施层 | 提供 Docker 化支撑；包括日志、监控、异常处理、环境连接适配、Docker 数据卷监控            | 日志管理模块、监控告警模块、异常处理模块、环境连接适配模块、Docker 数据监控模块                  | 日志框架（Python logging，按模块分类日志）、监控工具（Prometheus+Grafana，监控 Docker 数据卷使用率 / 任务执行率）、环境连接（Python telnetlib/paramiko，替代原 Java 客户端）、Docker SDK（Python Docker SDK，监控数据卷） |

### 3.2 核心模块交互图



```
@startuml 核心模块交互图

' 定义参与者与模块样式

actor "用户/外部系统" as User #lightblue

rectangle "表现层" #lightgreen {

component "前端交互" as Frontend

component "Django DRF API" as DjangoAPI

}

rectangle "业务逻辑层" #lightyellow {

component "环境管理模块" as EnvMgmt

component "测试套管理模块" as SuiteMgmt

component "模块管理模块" as ModuleMgmt

component "特性与测试用例管理模块" as FeatureCaseMgmt

component "用例执行管理模块" as ExecMgmt

component "用例执行结果管理模块" as ResultMgmt

}

rectangle "数据层" #lightcoral {

component "代码仓交互模块" as RepoSync

component "文件存储模块" as FileStore

component "数据存储模块（Django ORM）" as DataStore

node "Docker容器-MySQL" as DockerMySQL #orange

node "Docker数据卷-文件存储" as DockerVol #orange

}

rectangle "基础设施层" #lightpink {

component "Celery异步任务队列" as Celery

component "环境连接适配模块" as ConnAdapter

component "Docker数据监控模块" as DockerMonitor

component "监控告警模块" as AlertMgmt

component "日志管理模块" as LogMgmt

component "Docker数据清理模块" as DockerCleanup

component "Python Docker SDK" as DockerSDK

}

' 绘制交互关系

User --> Frontend : 界面操作

Frontend --> DjangoAPI : 接口请求

DjangoAPI --> EnvMgmt : 环境CRUD请求

DjangoAPI --> SuiteMgmt : 测试套CRUD请求

DjangoAPI --> ModuleMgmt : 模块CRUD请求

DjangoAPI --> FeatureCaseMgmt : 特性/用例管理请求

DjangoAPI --> ExecMgmt : 用例执行控制请求

DjangoAPI --> ResultMgmt : 结果查询/导出请求

' 业务逻辑层与基础设施层交互

ExecMgmt --> Celery : 提交用例执行任务

Celery --> ConnAdapter : 异步执行环境连接/用例跑测

FeatureCaseMgmt --> RepoSync : 同步代码仓特性/用例

ExecMgmt --> FileStore : 存储上传包/执行日志

ResultMgmt --> LogMgmt : 记录执行结果日志

' 数据层与Docker交互

FeatureCaseMgmt --> RepoSync : 触发同步

ExecMgmt --> FileStore : 读写文件

EnvMgmt --> DataStore : 读写环境数据

SuiteMgmt --> DataStore : 读写测试套数据

ModuleMgmt --> DataStore : 读写模块数据

FeatureCaseMgmt --> DataStore : 读写特性/用例数据

ExecMgmt --> DataStore : 读写执行任务数据

ResultMgmt --> DataStore : 读写结果数据

DataStore --> DockerMySQL : ORM操作数据（结构化数据）

FileStore --> DockerVol : 存储文件（日志/包）

' Docker监控与清理流程

DockerMonitor --> DockerSDK : 调用SDK获取数据卷信息

DockerSDK --> DockerVol : 监控使用率

DockerSDK --> DockerMySQL : 监控使用率

DockerSDK --> DockerMonitor : 返回使用率数据

DockerMonitor --> DockerCleanup : 使用率≥85%时触发清理

DockerCleanup --> DockerVol : 清理过期文件（保留近3个月核心数据）

DockerCleanup --> DockerMySQL : 清理1年以上历史日志

' 告警流程

ExecMgmt --> AlertMgmt : 任务异常触发告警

EnvMgmt --> AlertMgmt : 环境状态异常触发告警

DockerMonitor --> AlertMgmt : 清理后使用率仍≥80%触发告警

LogMgmt --> DockerVol : 日志写入数据卷

@enduml
```

## 四、模块详细设计

基于总体架构分层，对各核心模块进行精细化设计，明确模块内部功能拆解、输入输出参数、核心处理流程及异常处理机制，确保每个模块可独立开发与测试。

### 4.1 环境管理模块

#### 4.1.1 模块功能定义

环境管理模块是芯片验证环境的核心管理单元，负责实现验证环境（FPGA、Socket、QEMU、产品版）的全生命周期管理，包括环境创建、配置编辑、状态监控、连接测试与删除操作，同时保障环境连接的安全性与稳定性，为后续用例执行提供可靠的硬件 / 仿真环境支撑。

#### 4.1.2 核心功能拆解

| 功能点    | 功能描述 | 输入参数                     | 输出结果         | 
| ------- | ---- | ------------------------ | ------------ |
| 环境创建    | 支持 4 类环境类型选择，根据环境类型自动适配连接参数配置项（如 telnet 仅需 IP / 端口，redirect 需 IP / 密码 / 槽位） | 环境名称、类型、连接参数（IP / 端口 / 用户名 / 密码 / 槽位 / FTP 掩码）、负责人       | 环境 ID、创建时间、初始状态（待连接）      | `
| 环境连接测试  | 基于配置的连接参数，自动发起连接测试（如 telnet 端口探测、redirect 登录校验）  | 环境 ID        | 连接结果（成功 / 失败）、失败原因（端口不通 / 密码错误）     |
| 环境状态监控 | 定时（每 30 秒）检测环境连接状态，同步更新环境可用状态 | 环境 ID 列表 | 环境状态（可用 / 不可用 / 占用中）、最后检测时间  |
| 环境编辑 / 删除    | 支持修改环境连接参数（仅当环境未被占用时允许），删除环境（需先终止关联任务） | 环境 ID、待修改参数（可选）       | 操作结果（成功 / 失败）、失败原因（环境占用 / 无权限） | 
| FTP 配置管理    | 对需 FTP 操作的环境，存储并加密 FTP 掩码配置，支持配置校验 | 环境 ID、FTP 服务器地址、掩码规则        | 配置校验结果（通过 / 不通过）、加密后的配置存储 ID | 



1. **环境创建流程**

* 用户通过前端界面选择环境类型（FPGA/Socket/QEMU/ 产品版），填写基础信息（环境名称）；

* 根据环境类型差异化配置连接参数：


  * Telnet 连接：输入目标 IP、端口号；

  * Redirect 连接：输入 IP、登录用户名、密码、柜框槽位；

  *  FTP掩码可选填写；

* 模块调用 “环境连接适配模块” 执行连通性测试，验证参数有效性；

* 测试通过后，通过 Django ORM 将环境信息写入 MySQL，状态标记为 “在线”；测试失败则返回错误提示，阻断后续用例执行流程。连接成功后，共享telnet连接给后续用例执行使用（占上环境）

1. **环境状态监控流程**

* “Docker 数据监控模块” 定时（默认 5 分钟）触发环境状态巡检任务，通过 Python telnetlib/paramiko 库连接目标环境；

* 若连续 3 次连接失败，自动将环境状态更新为 “离线”，并触发 “监控告警模块”，向使用人弹窗提示环境连接失败；

* 环境恢复连接后，自动更新状态为 “在线”，并生成状态变更日志。

#### 4.1.3 核心数据结构



```
# 环境信息表（EnvInfo）- Django Model 定义

class EnvInfo(models.Model):

  ENV_TYPE_CHOICES = (

      ('FPGA', 'FPGA 环境'),

      ('Socket', 'Socket 环境'),

      ('QEMU', 'QEMU 仿真环境'),

      ('Product', '产品版环境')

  )

  ENV_STATUS_CHOICES = (

      ('Online', '在线'),

      ('Offline', '离线'),

      ('Busy', '占用中')

  )

  env_name = models.CharField(max_length=100, unique=True, verbose_name="环境名称")

  env_type = models.CharField(max_length=20, choices=ENV_TYPE_CHOICES, verbose_name="环境类型")

  project_id = models.ForeignKey(Project, on_delete=models.CASCADE, verbose_name="所属项目")

  owner = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, verbose_name="使用人")

  # 连接参数（JSON 格式存储差异化配置）

  conn_params = models.JSONField(verbose_name="连接参数")

  status = models.CharField(max_length=20, choices=ENV_STATUS_CHOICES, default='Offline', verbose_name="环境状态")

  create_time = models.DateTimeField(auto_now_add=True, verbose_name="创建时间")

  update_time = models.DateTimeField(auto_now=True, verbose_name="更新时间") 

  is_deleted = models.BooleanField(default=False, verbose_name="逻辑删除标记")

  class Meta:

      db_table = "env_info"

      verbose_name = "环境信息"

      verbose_name_plural = "环境信息"
```



### 4.2 测试套管理模块

#### 4.2.1 模块功能定义

负责测试套的创建、编辑、复制、删除与查询，支持用户个性化管理测试套（如关联指定环境、模块与用例），同时实现测试套的权限控制（仅创建者及管理员可修改），为批量执行用例提供统一载体。

#### 4.2.2 核心模块拆解

| 功能点     | 功能描述                                       | 输入参数                               | 输出结果                              |
| ------- | ------------------------------------------ | ---------------------------------- | --------------------------------- |
| 测试套创建   | 支持自定义测试套名称、描述，关联指定模块下的用例（可批量勾选）            | 测试套名称、描述、关联模块 ID 列表、关联用例 ID 列表、创建人 | 测试套 ID、创建时间、用例总数                  |
| 测试套复制   | 支持复制自己或他人的测试套（需有查看权限），复制后可修改关联用例           | 源测试套 ID、新测试套名称、是否保留用例关联            | 新测试套 ID、复制完成时间                    |
| 测试套编辑   | 支持修改测试套名称 / 描述，添加 / 移除关联用例（仅当测试套无运行中任务时允许） | 测试套 ID、待修改字段（名称 / 描述 / 用例列表）       | 操作结果（成功 / 失败）、失败原因（任务运行中 / 无权限）   |
| 测试套删除   | 删除测试套（需确保无关联的历史执行任务或已归档历史任务）               | 测试套 ID                             | 操作结果（成功 / 失败）、失败原因（存在未归档任务 / 无权限） |
| 测试套权限控制 | 支持设置测试套可见范围（私有 / 项目内可见），授权其他用户编辑权限         | 测试套 ID、可见范围、授权用户 ID 列表             | 权限配置结果、生效时间                       |

#### 4.2.2 核心业务流程



1. **测试套创建流程**

* 用户输入测试套名称、描述、模块关联环境（下拉选择在线环境，只有环境是产品版模块涉及关联）；

* 选择关联模块（从 “模块管理模块” 获取已创建模块），并勾选该模块下需纳入测试套的特性与用例；

* 存储测试套信息（含关联关系），生成唯一测试套 ID。可支持多个测试套关联同一个模块

1. **测试套复制流程**

* 用户选择目标测试套，发起复制请求，可修改复制后的测试套名称；

* 模块默认复制原测试套的 “关联环境、模块、特性、用例” 配置，用户可按需调整；

* 复制完成后，新测试套的创建者为当前用户，权限独立于原测试套。

* 测试套复制不包含定时任务

#### 4.2.3 核心数据结构



```
# 测试套信息表（TestSuite）

class TestSuite(models.Model):

  suite_name = models.CharField(max_length=100, verbose_name="测试套名称")

  suite_desc = models.TextField(null=True, blank=True, verbose_name="测试套描述")

  env = models.ForeignKey(EnvInfo, on_delete=models.CASCADE, verbose_name="关联环境")

  creator = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, verbose_name="创建者")

  create_time = models.DateTimeField(auto_now_add=True, verbose_name="创建时间")

  update_time = models.DateTimeField(auto_now=True, verbose_name="更新时间")

  is_deleted = models.BooleanField(default=False, verbose_name="逻辑删除标记")

  class Meta:

      db_table = "test_suite"

      verbose_name = "测试套信息"

      verbose_name_plural = "测试套信息"

# 测试套-用例关联表（SuiteCaseRelation）- 多对多关联中间表

class SuiteCaseRelation(models.Model):

  suite = models.ForeignKey(TestSuite, on_delete=models.CASCADE, verbose_name="测试套")

  test_case = models.ForeignKey(TestCase, on_delete=models.CASCADE, verbose_name="测试用例")

  add_time = models.DateTimeField(auto_now_add=True, verbose_name="添加时间")

  class Meta:

      db_table = "suite_case_relation"

      unique_together = ("suite", "test_case")  # 避免重复添加用例

      verbose_name = "测试套-用例关联"

      verbose_name_plural = "测试套-用例关联"
```


### 4.3 模块管理模块

#### 4.3.1 模块功能定义

实现芯片验证模块的创建、编辑、删除，建立模块与特性的关联关系，支持手动维护特性或从代码仓自动同步特性，为测试用例的归类管理提供层级结构（模块→特性→用例）。

#### 4.3.2 核心功能拆解

| 功能点      | 功能描述                                     | 输入参数                                         | 输出结果                        |
| -------- | ---------------------------------------- | -------------------------------------------- | --------------------------- |
| 立即执行任务创建 | 接收测试套与环境选择，校验环境可用性后，创建用例执行任务             | 测试套 ID、环境 ID、分支选择（可选，默认主分支）、本地包（可选，优先级高于分支包） | 任务 ID、任务状态（待执行）、预计开始时间      |
| 定时执行任务创建 | 支持设置任务执行时间（精确到分钟），到期自动触发执行               | 测试套 ID、环境 ID、执行时间、分支 / 本地包配置                 | 定时任务 ID、任务状态（待调度）、触发时间      |
| 任务执行控制   | 支持手动暂停（仅运行中任务）、继续（暂停中任务）、终止（待执行 / 运行中任务） | 任务 ID、操作类型（暂停 / 继续 / 终止）                     | 操作结果（成功 / 失败）、任务状态更新结果      |
| 分支包自动换包  | 根据用户勾选的分支，自动从代码仓拉取对应分支的包文件，推送至目标环境       | 任务 ID、分支名称                                   | 换包结果（成功 / 失败）、包版本号、推送时间     |
| 本地包上传换包  | 支持用户上传本地包文件（格式限制：.tar/.gz），校验通过后推送至目标环境  | 任务 ID、本地包文件、包版本描述                            | 上传进度、换包结果、包存储路径（Docker 数据卷） |

#### 4.3.2 核心业务流程



1. **模块创建与特性关联流程**

* 用户输入模块名称、所属芯片型号、模块描述；

* 选择特性添加方式：


  * 手动添加：（暂不支持，约束用户在代码仓中按规范格式添加用例）

  * 自动同步：选择关联的代码仓地址（从 “代码仓交互模块” 获取已配置仓库），指定分支，触发同步任务；

* “代码仓交互模块” 拉取指定分支的代码目录结构，src/dt/芯片型号 提取特性信息；

* 模块将模块信息及同步 / 手动添加的特性信息存储至数据库，建立 “模块 - 特性” 关联。

1. **特性同步更新流程**

* 用户对已创建模块发起 “重新同步” 请求，更新代码仓下master路径的代码；

* 模块对比本次同步的特性与历史特性：新增特性自动添加，删除特性如有与模块关联选择，删除关联关系（可考虑先标记为逻辑删除，后在后续清理任务中删除）；

* 同步完成后，生成同步日志，记录新增 / 删除 / 修改的特性数量。

* 用例更新对比历史用例：新增用例自动添加，删除用例如有与模块关联选择，删除关联关系（可考虑先标记为逻辑删除，后在后续清理任务中删除）；

#### 4.3.3 核心数据结构



```
# 模块信息表（Module）

class Module(models.Model):

  module_name = models.CharField(max_length=100, verbose_name="模块名称")

  chip_model = models.CharField(max_length=50, verbose_name="所属芯片型号")

  module_desc = models.TextField(null=True, blank=True, verbose_name="模块描述")

  creator = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, verbose_name="创建者")

  create_time = models.DateTimeField(auto_now_add=True, verbose_name="创建时间")

  update_time = models.DateTimeField(auto_now=True, verbose_name="更新时间")

  is_deleted = models.BooleanField(default=False, verbose_name="逻辑删除标记")

  class Meta:

      db_table = "module"

      verbose_name = "模块信息"

      verbose_name_plural = "模块信息"

# 特性信息表（Feature）

class Feature(models.Model):

  feature_name = models.CharField(max_length=100, verbose_name="特性名称")

  feature_desc = models.TextField(null=True, blank=True, verbose_name="特性描述")

  module = models.ForeignKey(Module, on_delete=models.CASCADE, verbose_name="所属模块")

  repo_url = models.CharField(max_length=200, null=True, blank=True, verbose_name="关联代码仓地址")

  repo_branch = models.CharField(max_length=50, null=True, blank=True, verbose_name="关联代码分支")

  status = models.CharField(max_length=20, choices=(('Online', '启用'), ('Offline', '下线')), default='Online', verbose_name="特性状态")

  sync_time = models.DateTimeField(null=True, blank=True, verbose_name="最后同步时间")

  create_time = models.DateTimeField(auto_now_add=True, verbose_name="创建时间")

  update_time = models.DateTimeField(auto_now=True, verbose_name="更新时间")

  class Meta:

      db_table = "feature"

      verbose_name = "特性信息"

      verbose_name_plural = "特性信息"
```



### 4.4 特性与测试用例管理模块

#### 4.4.1 模块功能定义

实现测试用例的全生命周期管理，支持从代码仓自动同步用例或手动创建用例，建立 “特性 - 用例” 关联关系，对用例进行分类、查询与状态维护，确保用例与芯片特性的一致性。

#### 4.4.2 核心功能拆解

| 功能点      | 功能描述                                                   | 输入参数                                            | 输出结果                     |
| -------- | ------------------------------------------------------ | ----------------------------------------------- | ------------------------ |
| 执行结果实时收集 | 实时接收 Celery 任务推送的用例执行日志与状态（成功 / 失败 / 跳过）               | 任务 ID、用例 ID、执行状态、日志片段、执行时间                      | 结果记录 ID、更新时间             |
| 任务结果汇总   | 当所有用例子任务执行完成后，自动汇总任务整体结果（全量成功 / 部分失败 / 全部失败）           | 任务 ID                                           | 任务整体状态、成功用例数、失败用例数、执行总时长 |
| 结果查询与筛选  | 支持按任务 ID、测试套、环境、执行时间、结果状态筛选查询，展示关键信息（开始 / 结束时间、状态、用例数） | 查询条件（任务 ID / 测试套 ID / 环境 ID / 时间范围 / 结果状态）、分页参数 | 任务结果列表（含关键信息）、总条数、分页信息   |
| 执行日志导出   | 支持导出单个任务的完整执行日志（含每个用例的详细日志），格式为 PDF/CSV                | 任务 ID、导出格式                                      | 日志文件下载链接（有效期 24 小时）、文件大小 |
| 失败用例标记   | 对执行失败的用例，支持标记 “待分析”“已定位”“无需处理” 状态，记录分析备注               | 任务 ID、用例 ID、标记状态、分析备注                           | 标记结果、更新时间                |

#### 4.4.2 核心业务流程



1. **用例自动同步流程**

* 用户选择目标特性，发起 “用例同步” 请求，指定代码仓中用例存放路径（如 `/testcases/usb/`）；

* “代码仓交互模块” 拉取指定路径下的用例文件（如 .py/.sh 用例脚本），解析用例名称、用例 ID、前置条件等信息；

* 模块对比同步用例与数据库中已有用例：新增用例自动创建并关联特性，已存在用例更新脚本内容与描述，删除用例标记为 “已废弃”，如有同名用例但是路径更新仅更新路径；

* 同步完成后，生成同步报告，展示新增 / 更新 / 废弃的用例数量。

1. **用例手动创建流程（暂不考虑，约束用户使用代码仓按规范添加）**
#### 4.4.3 核心数据结构



```
# 测试用例表（TestCase）

class TestCase(models.Model):

  CASE_STATUS_CHOICES = (

      ('Available', '可用'),

      ('Unavailable', '不可用'),

      ('Deprecated', '已废弃')

  )

  case_id = models.CharField(max_length=50, unique=True, verbose_name="用例ID")

  case_name = models.CharField(max_length=100, verbose_name="用例名称")

  feature = models.ForeignKey(Feature, on_delete=models.CASCADE, verbose_name="所属特性")

  pre_condition = models.TextField(verbose_name="前置条件")

  execute_steps = models.TextField(verbose_name="执行步骤")

  expected_result = models.TextField(verbose_name="预期结果")

  script_file = models.CharField(max_length=200, verbose_name="用例脚本路径（Docker 数据卷内）")

  status = models.CharField(max_length=20, choices=CASE_STATUS_CHOICES, default='Available', verbose_name="用例状态")

  sync_time = models.DateTimeField(null=True, blank=True, verbose_name="最后同步时间")

```

### 4.5 其他核心模块简述



| 模块名称          | 核心功能                                     | 关键技术实现                                                  |
| ------------- | ---------------------------------------- | ------------------------------------------------------- |
| 模块管理模块        | 管理 “模块 - 特性” 层级关系，支持模块 CRUD，关联代码仓路径      | 与 “代码仓交互模块” 联动，同步代码仓目录结构生成特性；通过 Django ORM 维护层级关系       |
| 特性与测试用例管理模块   | 从代码仓自动同步特性与用例（按代码仓路径映射），支持用例手动关联 / 解绑    | 定时（每小时）调用 Python-GitLab 接口拉取代码仓目录；用例 ID 与代码仓文件路径绑定      |
| 日志管理模块        | 收集所有模块的操作日志（用户操作、系统事件），留存≥6 个月，支持日志查询    | 基于 Python logging 框架，日志按模块分类存储；日志归档（每日压缩，保留 6 个月）       |
| Docker 数据监控模块 | 监控 Docker 数据卷（MySQL 数据卷、文件存储卷）使用率，触发清理机制 | 调用 Python Docker SDK 获取卷使用率；使用率≥85% 时触发 “Docker 数据清理模块” |
| 异常处理模块        | 捕获系统运行中的异常（如数据库连接失败、环境连接超时），执行恢复策略       | 基于 Django 中间件捕获全局异常；关键异常触发数据备份（增量备份）                    |

## 五、接口设计

基于 “表现层 - 业务逻辑层” 的交互需求，设计统一的 API 接口规范（RESTful 风格），明确接口类型、URL、请求参数、响应格式及权限控制，支撑前端交互与外部系统接入。

### 5.1 接口规范总则

1. **URL 命名规则**：采用 “/api/v1/\[模块名]/\[资源名]” 格式，全小写，多词用 “-” 分隔（如`/api/v1/env-management/environments`）；

2. **请求方法**：遵循 RESTful 规范（GET - 查询、POST - 创建、PUT - 全量更新、PATCH - 部分更新、DELETE - 删除）；

3. **参数格式**：请求体（POST/PUT/PATCH）采用 JSON 格式，URL 参数（GET/DELETE）采用键值对；

4. **响应格式**：统一 JSON 格式，包含 “状态码”“消息”“数据” 三部分，示例：



```
{

 "code": 200,          // 200-成功，4xx-客户端错误，5xx-服务端错误

 "message": "操作成功", // 描述信息（错误时为错误原因）

 "data": {}            // 业务数据（查询时为结果集，创建时为资源ID等）

}
```



1. **权限控制**：所有接口需携带 Token（请求头：Authorization: Bearer \[Token]），通过 Django REST Framework 的权限类校验用户权限（如管理员可删除任意环境，普通用户仅可删除自己创建的环境）；

2. **分页规则**：查询类接口（如获取任务结果列表）默认分页，参数：`page`（页码，默认 1）、`size`（每页条数，默认 20），响应 “data” 含 “list”（数据列表）、“total”（总条数）、“page”“size”。


### 5.2 核心模块接口设计示例

#### 5.2.1 环境管理模块接口

| 接口名称    | 请求方式 | 接口路径                     | 功能描述         | 请求参数示例                                                                                                                                | 返回参数示例                                                                                             |
| ------- | ---- | ------------------------ | ------------ | ------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------- |
| 创建环境    | POST | /api/v1/env/create       | 创建新验证环境      | `{"env_name":"FPGA_01","env_type":"FPGA","project_id":1,"owner_id":2,"conn_params":{"ip":"192.168.1.100","port":23,"type":"telnet"}}` | `{"code":200,"msg":"创建成功","data":{"env_id":1,"env_name":"FPGA_01","status":"Online"}}`             |
| 查询环境列表  | GET  | /api/v1/env/list         | 分页查询环境信息     | `{"page":1,"size":10,"env_type":"FPGA","status":"Online"}`                                                                            | `{"code":200,"data":{"total":5,"list":[{"env_id":1,"env_name":"FPGA_01","status":"Online"},...]}}` |
| 测试环境连通性 | POST | /api/v1/env/test-connect | 验证环境连接参数有效性  | `{"env_id":1}`                                                                                                                        | `{"code":200,"msg":"连通性测试通过"}` / `{"code":400,"msg":"连接失败：超时"}`                                    |
| 删除环境    | POST | /api/v1/env/delete       | 逻辑删除环境（支持批量） | `{"env_ids":[1,2]}`                                                                                                                   | `{"code":200,"msg":"删除成功，共删除 2 个环境"}`                                                              |

#### 5.2.2 测试套管理模块接口

| 接口名称    | 请求方式 | 接口路径                 | 功能描述          | 请求参数示例                                                                           | 返回参数示例                                                                                                                 |
| ------- | ---- | -------------------- | ------------- | -------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| 创建测试套   | POST | /api/v1/suite/create | 创建测试套并关联用例    | `{"suite_name":"USB测试套","suite_desc":"USB功能验证","env_id":1,"case_ids":[101,102]}` | `{"code":200,"msg":"创建成功","data":{"suite_id":5}}`                                                                      |
| 复制测试套   | POST | /api/v1/suite/copy   | 复制已有测试套       | `{"source_suite_id":5,"new_suite_name":"USB测试套_副本"}`                             | `{"code":200,"msg":"复制成功","data":{"new_suite_id":6}}`                                                                  |
| 编辑测试套   | POST | /api/v1/suite/edit   | 修改测试套配置       | `{"suite_id":5,"env_id":2,"case_ids":[101,103]}`                                 | `{"code":200,"msg":"编辑成功"}`                                                                                            |
| 查询测试套详情 | GET  | /api/v1/suite/detail | 获取测试套关联的环境、用例 | `{"suite_id":5}`                                                                 | `{"code":200,"data":{"suite_name":"USB测试套","env_name":"FPGA_01","cases":[{"case_id":101,"case_name":"USB枚举测试"},...]}}` |

#### 5.2.3 模块管理模块接口

| 接口名称   | 请求方式 | 接口路径                        | 功能描述      | 请求参数示例                                                                                                                                         | 返回参数示例                                                                                                      |
| ------ | ---- | --------------------------- | --------- | ---------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| 创建模块   | POST | /api/v1/module/create       | 创建模块并关联特性 | `{"module_name":"USB模块","chip_model":"CHIP_X1","module_desc":"USB控制器验证","features":[{"feature_name":"USB2.0","feature_desc":"USB2.0功能"},...]}` | `{"code":200,"msg":"创建成功","data":{"module_id":3}}`                                                          |
| 同步特性   | POST | /api/v1/module/sync-feature | 从代码仓同步特性  | `{"module_id":3,"repo_url":"https://gitlab.com/chip-x1/usb.git","repo_branch":"main"}`                                                         | `{"code":200,"msg":"同步完成","data":{"add_count":2,"delete_count":0,"update_count":1}}`                        |
| 查询模块列表 | GET  | /api/v1/module/list         | 分页查询模块信息  | `{"page":1,"size":10,"chip_model":"CHIP_X1"}`                                                                                                  | `{"code":200,"data":{"total":3,"list":[{"module_id":3,"module_name":"USB模块","chip_model":"CHIP_X1"},...]}}` |


#### 5.2.4 用例执行管理模块接口

| 接口名称     | 请求方法  | URL                                                          | 请求参数（JSON/URL）                                                                                                                                                     | 响应数据（data 字段）                                                                                                              | 权限要求       |
| -------- | ----- | ------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------- | ---------- |
| 创建立即执行任务 | POST  | /api/v1/execution-management/tasks/immediate                 | -body：{"suite\_id": "suite-789",  "env\_id": "env-123",  "branch": "develop"（可选）,  "local\_package": {    "file\_id": "file-456",    "version\_desc": "v2.1"}（可选）} | {  "task\_id": "task-101",  "status": "pending",  "expected\_start\_time": "2024-05-20T15:00:00Z",  "lock\_env": true}     | 测试套创建人或管理员 |
| 创建定时执行任务 | POST  | /api/v1/execution-management/tasks/scheduled                 | -body：{  "suite\_id": "suite-789",  "env\_id": "env-123",  "execute\_time": "2024-05-21T09:30:00Z",  "branch": "main"  }                                           | {  "scheduled\_task\_id": "sch-task-202",  "status": "to\_schedule",  "trigger\_time": "2024-05-21T09:30:00Z"}             | 测试套创建人或管理员 |
| 控制任务执行   | PATCH | /api/v1/execution-management/tasks/{task\_id}/control        | -path：task\_id（任务 ID）-body：{"operation": "pause/continue/terminate"}                                                                                               | {  "operation\_result": "success",  "task\_status": "paused/running/terminated",  "operate\_time": "2024-05-20T15:05:00Z"} | 任务创建人或管理员  |
| 分支包自动换包  | POST  | /api/v1/execution-management/tasks/{task\_id}/branch-package | -path：task\_id（任务 ID）-body：{"branch\_name": "feature/valid-2024"}                                                                                                  | {  "package\_switch\_result": "success",  "package\_version": "v2.1-feature",  "push\_time": "2024-05-20T15:02:00Z"}       | 任务创建人      |


#### 5.2.5 用例执行结果管理模块接口



| 接口名称     | 请求方法  | URL                                                              | 请求参数（JSON/URL）                                                                                                                 | 响应数据（data 字段）                                                                                                                                                                    | 权限要求               |
| -------- | ----- | ---------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------ |
| 查询任务结果列表 | GET   | /api/v1/result-management/task-results                           | -query：task\_id（可选）、suite\_id（可选）、env\_id（可选）、start\_time（可选）、end\_time（可选）、status（可选）、page=1、size=20                          | {  "list": \[{"task\_id": "task-101", "suite\_name": "Suite-A", "env\_name": "FPGA-01", "start\_time": "...", "status": "success", ...}],  "total": 30,  "page": 1,  "size": 20} | 普通用户及以上（仅可见有权限的任务） |
| 导出执行日志   | POST  | /api/v1/result-management/tasks/{task\_id}/export-log            | -path：task\_id（任务 ID）-body：{"format": "pdf/csv"}                                                                               | {  "download\_url": "http://xxx/api/v1/download/logs/task-101.pdf",  "expire\_time": "2024-05-21T15:00:00Z",  "file\_size": "2.5MB"}                                             | 任务创建人或管理员          |
| 标记失败用例   | PATCH | /api/v1/result-management/tasks/{task\_id}/cases/{case\_id}/mark | -path：task\_id（任务 ID）、case\_id（用例 ID）-body：{"mark\_status": "to\_analyze/located/no\_need",  "analysis\_note": "接口超时导致失败"（可选）} | {  "mark\_result": "success",  "mark\_status": "to\_analyze",  "update\_time": "2024-05-20T16:10:00Z"}                                                                           | 任务创建人或管理员          |


## 六、数据存储设计

基于 Docker 容器化部署架构，设计数据存储方案，明确数据分类、存储介质、表结构设计、数据备份与清理策略，确保数据安全性、可靠性与可扩展性。
### 6.1 数据分类与存储介质

根据数据类型与访问频率，划分存储介质，优化存储性能与成本。



| 数据类别     | 数据描述                                     | 存储介质                     | 存储策略                                                          |
| -------- | ---------------------------------------- | ------------------------ | ------------------------------------------------------------- |
| 结构化业务数据  | 环境信息、测试套信息、任务信息、用例结果、用户权限等（需高频查询与事务性操作）  | Docker 内 MySQL 8.0（主从架构） | 核心表采用 InnoDB 引擎，支持事务；建立索引优化查询（如任务 ID、测试套 ID 索引）               |
| 非结构化文件数据 | 本地上传包、执行日志文件、导出的 PDF/CSV 报告等（大文件，访问频率较低） | Docker 数据卷（挂载宿主机目录）      | 按数据类型划分目录（/vol/packages/、/vol/logs/、/vol/reports/）；文件命名含唯一 ID |
| 缓存数据     | 高频访问的环境状态、任务状态、用户 Token 等（需低延迟访问）        | Docker 内 Redis 7.0       | 环境状态缓存过期时间 30 秒（与监控频率一致）；Token 缓存过期时间 2 小时                    |
| 归档数据     | 超过 3 个月的执行日志、1 年以上的历史任务结果（极少访问，需长期留存）    | 宿主机本地归档目录（或云存储）          | 每月 1 次归档；归档文件压缩（.tar.gz）；记录归档索引至 MySQL 归档表                    |

### 6.2 核心数据库表结构设计

基于 Django ORM 模型设计，定义核心表结构，明确字段类型、主键、外键及约束关系。

#### 6.2.1 环境信息表（tb_environment）



| 字段名               | 字段类型         | 约束条件                        | 描述                                           |
| ----------------- | ------------ | --------------------------- | -------------------------------------------- |
| id                | VARCHAR(64)  | PRIMARY KEY                 | 环境唯一 ID（格式：env-xxx）                          |
| name              | VARCHAR(128) | NOT NULL, UNIQUE            | 环境名称（如 FPGA-Test-01）                         |
| type              | VARCHAR(32)  | NOT NULL                    | 环境类型（FPGA/Socket/QEMU/Product）               |
| conn_type         | VARCHAR(32)  | NOT NULL                    | 环境连接方式（Telnet/Redirect）               |
| ip                | VARCHAR(32)  | NOT NULL                    | 环境 IP 地址（如 192.168.1.100）                |
| admin             | VARCHAR(32)  | NULL                        | mml账号名(不填默认为admin)             |
| admin_password    | VARCHAR(128) | NOT NULL                    | mml账号密码            |
| cabinet_frame_slot| VARCHAR(128) | NOT NULL                    | Redirect连接方式下需要：机柜槽位             |
| port              | VARCHAR(128) | NOT NULL                    | Telnet连接方式下需要：端口             |
| ftp_mask          | VARCHAR(128) | NULL                        | 加密后的 FTP 配置（仅需 FTP 操作的环境有值）                  |
| status            | VARCHAR(32)  | NOT NULL, DEFAULT 'pending' | 环境状态（pending/available/unavailable/occupied） |
| owner             | VARCHAR(64)  | NOT NULL                    | 环境负责人（关联 tb_user.id）                        |
| last_check_time | DATETIME     | NULL                        | 最后一次状态检查时间                                   |
| create_time      | DATETIME     | NOT NULL, DEFAULT NOW()     | 创建时间                                         |
| update_time      | DATETIME     | NOT NULL, DEFAULT NOW()     | 更新时间                                         |

#### 6.2.2 测试套信息表（tb_test_suite）



| 字段名                | 字段类型             | 约束条件                        | 描述                     |
| ------------------ | ---------------- | --------------------------- | ---------------------- |
| id                 | VARCHAR(64)      | PRIMARY KEY                 | 测试套唯一 ID（格式：suite-xxx） |
| name               | VARCHAR(128)     | NOT NULL                    | 测试套名称                  |
| description        | TEXT             | NULL                        | 测试套描述                  |
| visible_scope     | VARCHAR(32)      | NOT NULL, DEFAULT 'private' | 可见范围（private/project）  |
| creator            | VARCHAR(64)      | NOT NULL                    | 创建人（关联 tb_user.id）    |
| case_count        | INT              | NOT NULL, DEFAULT 0         | 关联用例总数                 |
| create_time       | DATETIME         | NOT NULL, DEFAULT NOW()     | 创建时间                   |
| update_time       | DATETIME         | NOT NULL, DEFAULT NOW()     | 更新时间                   |
| INDEX idx_creator | (creator)        | -                           | 按创建人查询索引               |
| INDEX idx_scope   | (visible_scope) | -                           | 按可见范围筛选索引              |

#### 6.2.3 任务执行信息表（tb_execution_task）



| 字段名               | 字段类型                     | 约束条件                | 描述                                                     |
| ----------------- | ------------------------ | ------------------- | ------------------------------------------------------ |
| id                | VARCHAR(64)              | PRIMARY KEY         | 任务唯一 ID（格式：task-xxx）                                   |
| suite_id         | VARCHAR(64)              | NOT NULL            | 关联测试套 ID（外键：tb_test_suite.id）                        |
| env_id           | VARCHAR(64)              | NOT NULL            | 关联环境 ID（外键：tb_environment.id）                         |
| package_info     | TEXT                     | NOT NULL            | 包信息（存储 JSON 字符串，含包类型、版本、路径）                            |
| status            | VARCHAR(32)              | NOT NULL            | 任务状态（pending/running/paused/terminated/success/failed） |
| start_time       | DATETIME                 | NULL                | 开始时间                                                   |
| end_time         | DATETIME                 | NULL                | 结束时间                                                   |
| executor          | VARCHAR(64)              | NOT NULL            | 执行人（关联 tb_user.id）                                    |
| total_case       | INT                      | NOT NULL, DEFAULT 0 | 总用例数                                                   |
| success_case     | INT                      | NOT NULL, DEFAULT 0 | 成功用例数                                                 |
| failed_case      | INT                      | NOT NULL, DEFAULT 0 | 失败用例数                                                 |
| INDEX idx_suite  | (suite_id)              | -                   | 按测试套查询索引                                              |
| INDEX idx_env    | (env_id)                | -                   | 按环境查询索引                                               |
| INDEX idx_status | (status)                 | -                   | 按状态筛选索引                                                |
| INDEX idx_time   | (start_time, end_time) | -                   | 按时间范围查询索引                                              |

#### 6.2.4 用例结果表（tb_case_result）



| 字段名             | 字段类型           | 约束条件           | 描述                                      |
| --------------- | -------------- | -------------- | --------------------------------------- |
| id              | VARCHAR(64)    | PRIMARY KEY    | 结果唯一 ID（格式：case-result-xxx）             |
| task_id        | VARCHAR(64)    | NOT NULL       | 关联任务 ID（外键：tb_execution_task.id）      |
| case_id        | VARCHAR(64)    | NOT NULL       | 用例 ID（关联 tb_test_case.id）             |
| status          | VARCHAR(32)    | NOT NULL       | 用例状态（success/failed/skipped）            |
| mark_status    | VARCHAR(32)    | DEFAULT 'none' | 标记状态（none/to_analyze/located/no_need） |
| analysis_note  | TEXT           | NULL           | 分析备注                                    |
| execute_time   | DATETIME       | NOT NULL       | 执行时间                                    |
| log_path       | VARCHAR(256)   | NOT NULL       | 日志文件路径（Docker 数据卷内路径）                   |
| INDEX idx_task | (task_id)     | -              | 按任务查询索引（核心索引，高频查询）                      |
| INDEX idx_case | (case_id)     | -              | 按用例查询索引                                 |
| INDEX idx_mark | (mark_status) | -              | 按标记状态筛选索引                              |

### 6.3 数据备份与清理策略

#### 6.3.1 数据备份策略



| 备份类型 | 备份对象               | 备份频率           | 备份方式                                                   | 备份保留时长 |
| ---- | ------------------ | -------------- | ------------------------------------------------------ | ------ |
| 增量备份 | MySQL 结构化数据        | 每小时 1 次        | 通过 MySQL binlog 实现增量备份；备份文件存储至宿主机 /backup/incremental/ | 7 天    |
| 全量备份 | MySQL 结构化数据        | 每天 1 次（凌晨 2 点） | 使用 mysqldump 工具全量导出；备份文件压缩后存储至宿主机 /backup/full/        | 30 天   |
| 文件备份 | Docker 数据卷文件（包、日志） | 每周 1 次         | 按目录打包压缩；存储至宿主机 /backup/files/ 或云存储                     | 90 天   |
| 应急备份 | 核心业务表（环境、测试套、任务）   | 实时触发           | 数据更新时自动生成备份日志（Django 信号机制）；异常时触发应急恢复                   | 24 小时  |

#### 6.3.2 数据清理策略



| 清理对象         | 清理条件                                | 清理频率           | 清理方式                                                | 注意事项                                  |
| ------------ | ----------------------------------- | -------------- | --------------------------------------------------- | ------------------------------------- |
| Docker 数据卷日志 | 日志文件创建时间超过 3 个月；或单个日志文件超过 1GB       | 每天 1 次（凌晨 3 点） | 调用 Python 脚本删除过期文件；大文件按时间分片清理（保留最近 7 天片段）           | 清理前校验是否存在未导出的结果关联；清理后更新日志索引表          |
| MySQL 历史数据   | 任务结果超过 1 年；操作日志超过 6 个月              | 每月 1 次（1 号凌晨）  | 按时间范围删除；归档数据先导出至归档目录再删除                             | 清理前执行全量备份；删除操作使用事务，失败时回滚              |
| Redis 缓存数据   | 缓存过期（按预设过期时间）；缓存占用超过 Redis 总内存的 80% | 实时 + 每天 1 次    | 过期数据自动淘汰；内存超限时触发 LRU 淘汰策略（优先淘汰低频访问缓存）               | 避免核心缓存（如环境状态）被误淘汰；定期监控缓存命中率           |
| 临时文件         | 导出报告超过 24 小时；上传的临时包超过 72 小时         | 每 6 小时 1 次     | 扫描临时目录（/vol/temp/）删除过期文件；记录清理日志至 /vol/cleanup/logs/ | 确保临时文件无正在进行的读写操作；清理前通知相关用户（如导出报告即将过期） |

## 七、非功能需求实现方案

### 7.1 性能优化



1. **任务处理性能**：

* 采用异步处理框架（Spring Async），将漏洞检测、报告生成等耗时操作放入线程池（核心线程数 = CPU 核心数 ×2，最大线程数 = CPU 核心数 ×4），避免阻塞主流程。

* 对验证任务进行资源隔离（使用线程池隔离策略），防止单个任务占用过多资源影响其他任务。

1. **数据查询性能**：

* 为高频查询字段建立索引（如 tb_execution_task 的 status、create_time 字段，tb_bug_info 的 task_id、severity 字段）。

* 对大数据量报表查询采用预计算机制（定时任务每日凌晨计算昨日统计数据，存储至汇总表），减少实时计算压力。

### 7.2 安全性保障



1. **用户安全**：

* 密码存储采用 BCrypt 加密（加盐哈希），不存储明文密码；支持双因素认证（2FA），管理员登录需额外验证。

* 实现操作审计日志，记录用户的关键操作（如创建任务、修改策略），包含操作人、时间、IP 地址、操作内容，日志不可篡改。

1. **数据安全**：

* 敏感数据（如验证用例、芯片设计细节）在数据库中加密存储，密钥通过 KMS（密钥管理服务）管理，定期轮换（每 90 天）。

* 对导出的报告文件添加水印（含用户 ID 与时间戳），防止未授权传播。

### 7.3 可扩展性设计



1. **插件化架构**：

* 核心框架定义标准接口（如芯片类型适配接口、检测规则接口），新增芯片架构或检测规则时，只需开发对应的插件（JAR 包），通过插件管理模块热加载，无需修改核心代码。

* 插件注册中心（基于 Nacos）管理插件版本与依赖，支持插件在线升级与回滚。

1. **水平扩展**：

* 业务逻辑层服务（如任务管理、漏洞检测）设计为无状态服务，可通过 Kubernetes 动态扩缩容（基于 CPU 使用率阈值 70%）。

* 数据库采用主从架构，支持新增从库分担查询压力；Redis 采用集群模式（3 主 3 从），支持分片存储与故障自动转移。

## 八、异常处理设计

### 8.1 异常分类与处理策略



| 异常类型   | 定义                                 | 处理策略                                   | 示例                          |
| ------ | ---------------------------------- | -------------------------------------- | --------------------------- |
| 业务异常   | 因用户操作错误或业务规则不满足导致的异常（如任务参数无效、权限不足） | 返回明确错误信息（错误码 + 描述），引导用户修正操作            | 错误码：400，描述：“芯片型号不在支持列表中”    |
| 系统异常   | 因系统内部故障导致的异常（如数据库连接失败、接口调用超时）      | 记录详细日志（错误堆栈），返回通用错误信息，触发告警通知           | 错误码：500，描述：“系统繁忙，请稍后重试”     |
| 外部依赖异常 | 与外部工具（如验证工具、存储服务）交互失败导致的异常         | 重试机制（最多 3 次，间隔 1s），若失败则降级处理（如缓存数据临时替代） | 验证工具连接超时，重试 3 次后使用本地缓存的历史数据 |

### 8.2 异常监控与告警



1. **监控指标**：通过 Prometheus 采集系统关键指标（接口响应时间、错误率、CPU / 内存使用率），设置阈值（如接口错误率 > 5%、CPU 使用率 > 90%）。

2. **告警触发**：当指标超过阈值时，Grafana 触发告警，通过多种渠道通知（短信 / 邮件给管理员，系统内弹窗给在线用户），告警级别分为紧急（需立即处理）、重要（4 小时内处理）、提示（24 小时内处理）。

3. **故障定位**：集成 APM 工具（如 SkyWalking），追踪异常调用链路，记录各模块耗时与错误点，生成故障诊断报告，辅助开发人员快速定位问题。

## 第九章 页面设计

基于前文模块功能（如环境管理、测试套管理、用例执行）与接口设计，结合用户操作流程，设计前端页面架构与核心页面细节，明确页面布局、元素交互规则及与后端接口的映射关系，为前端开发（Vue3+Element Plus）提供直接指导。

### 9.1 页面架构设计

采用 “顶部导航栏 + 左侧侧边栏 + 中间内容区” 的经典布局，确保功能分区清晰，用户操作路径短。页面层级遵循 “首页→功能模块页→详情 / 操作页” 的逻辑，与业务模块一一对应。

#### 9.1.1 整体布局结构



| 布局区域  | 核心职责                                      | 固定性 | 关键元素                                                        |
| ----- | ----------------------------------------- | --- | ----------------------------------------------------------- |
| 顶部导航栏 | 展示系统名称、用户信息（头像 / 名称）、全局操作（消息通知、帮助中心、退出登录） | 固定  | 系统 Logo（左侧）、用户下拉菜单（右侧，含 “个人中心”“修改密码”）、通知图标（未读消息红点提示）        |
| 侧侧边栏 | 展示功能模块入口，支持折叠 / 展开，高亮当前所在模块               | 可折叠 | 模块分组（环境管理、测试套管理、用例执行、结果分析等）、模块图标（Element Plus 图标库）、当前模块高亮标识 |
| 中间内容区 | 展示当前模块的具体内容（列表、表单、详情等），支持分页、筛选、搜索         | 动态  | 操作按钮（新增 / 编辑 / 删除等）、筛选条件区、数据列表 / 表单、分页控件、结果统计卡片             |
| 底部状态栏 | 展示系统版本、当前时间、操作日志入口（点击跳转至 “日志管理” 页面）       | 固定  | 系统版本号（左侧）、当前时间（居中）、“操作日志” 链接（右侧）                            |

#### 9.1.2 页面层级与模块映射



| 一级页面（侧边栏模块） | 二级页面（内容区页面）     | 对应业务模块        | 核心功能                                                                |
| ----------- | --------------- | ------------- | ------------------------------------------------------------------- |
| 环境管理        | 环境列表页           | 环境管理模块        | 展示所有环境（含状态标签）、环境筛选（按类型 / 状态）、批量操作（测试连接）、新增 / 编辑 / 删除环境入口            |
| 环境管理        | 环境新增 / 编辑页      | 环境管理模块        | 环境信息表单（含类型选择、连接参数配置、FTP 配置）、参数校验提示、保存 / 取消按钮                        |
| 测试套管理       | 测试套列表页          | 测试套管理模块       | 测试套筛选（按创建人 / 可见范围）、搜索（按名称）、复制测试套入口、新增 / 编辑 / 删除按钮                   |
| 测试套管理       | 测试套配置页（新增 / 编辑） | 测试套管理模块       | 基础信息表单（名称 / 描述 / 可见范围）、用例关联（树形选择 “模块 - 特性 - 用例”）、权限配置（授权用户）         |
| 用例执行        | 任务列表页           | 用例执行管理模块      | 任务筛选（按状态 / 时间 / 测试套 / 环境）、任务操作（暂停 / 继续 / 终止 / 查看日志）、新增执行任务入口        |
| 用执行        | 新增执行任务页         | 用例执行管理模块      | 测试套选择（下拉选择）、环境选择（仅展示 “可用” 状态环境）、包配置（分支选择 / 本地包上传）、执行方式（立即执行 / 定时执行） |
| 结果分析        | 任务结果列表页         | 用例执行结果管理模块    | 结果筛选（按执行时间 / 结果状态 / 测试套）、结果统计（成功 / 失败用例数卡片）、日志导出入口                  |
| 结果分析        | 用例结果详情页         | 用例执行结果管理模块    | 任务基础信息（执行时间 / 环境 / 包版本）、用例结果列表（按状态分组）、失败用例标记（下拉选择状态 + 备注输入）         |
| 系统管理        | 用户管理页           | 权限管理模块（前文未详述） | 用户列表（含角色）、新增 / 编辑用户（配置角色）、重置密码按钮                                    |
| 系统管理        | 日志管理页           | 日志管理模块        | 操作日志筛选（按用户 / 时间 / 操作类型）、日志详情查看（弹窗展示）                                |

### 9.2 核心页面详细设计

针对高频使用的核心页面，明确页面布局、元素交互规则、表单校验逻辑及与后端接口的映射关系，确保前端开发与后端接口无缝衔接。

#### 9.2.1 环境列表页（高频核心页）

##### 1. 页面布局（从上到下）



| 页面区域  | 元素组成                                                                             | 交互规则                                                                                                                                                 | 接口映射                                                                                                                                                |
| ----- | -------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| 操作按钮区 | “新增环境” 按钮（主色调，左侧）、“批量测试连接” 按钮（次要色调，中间）、“刷新” 按钮（图标，右侧）                            | - 点击 “新增环境” 跳转至 “环境新增页”；- 勾选环境后，“批量测试连接” 按钮激活（未勾选时置灰），点击触发批量连接测试，显示测试进度弹窗；- 点击 “刷新” 按钮，重新调用 “获取环境列表” 接口（GT /api/v1/env-management/environments）刷新列表 | “批量测试连接”→POST /api/v1/env-management/environments/batch-test-connect；“刷新”→GET /api/v1/env-management/environments                                    |
| 筛选条件区 | 环境类型筛选（下拉选择：全部 / FPGA/Socket/QEMU/ 产品版）、环境状态筛选（下拉选择：全部 / 可用 / 不可用 / 占用中）、“重置” 按钮 | - 筛选条件变更后，自动触发列表刷新（延迟 0.5 秒，避免频繁请求）；- 点击 “重置”，清空所有筛选条件，恢复默认列表                                                                                        | 筛选参数拼接至 “获取环境列表” 接口的 query 参数（如？type=FPGA\&status=available）                                                                                         |
| 数据列表区 | 表头（环境名称、类型、状态、负责人、创建时间、操作）、列表行（含状态标签、操作按钮）                                       | - 状态标签样式：可用（绿色）、不可用（红色）、占用中（橙色）、待连接（灰色）；- 操作列按钮：编辑（图标）、删除（图标，hover 提示 “确认删除？”）、测试连接（文字按钮，仅对 “待连接 / 不可用” 状态显示）                                        | - 编辑→跳转至 “环境编辑页”；- 删除→调用 DELETE /api/v1/env-management/environments/{env_id}；- 测试连接→POST /api/v1/env-management/environments/{env_id}/test-connect |
| 分页控件区 | 页码选择、每页条数选择（10/20/50 条）、总条数显示（“共 xx 条”）                                          | - 切换页码 / 每页条数时，调用 “获取环境列表” 接口，传入 page/size 参数；- 总条数从接口响应的 “total” 字段获取                                                                               | GET /api/v1/env-management/environments?page=xx\&size=xx                                                                                             |

##### 2. 关键交互细节



* **环境状态标签交互**：hover 状态标签时，显示 “最后检查时间：xx” 的 tooltip 提示（数据来自环境表的 “last_check_time” 字段）；

* **删除确认弹窗**：点击 “删除” 按钮后，弹出确认弹窗（标题 “确认删除”，内容 “删除后不可恢复，是否继续？”），点击 “确认” 执行删除接口，删除成功后刷新列表并显示 “删除成功” 的全局提示（Element Plus Message 组件）；

* **批量测试连接进度**：点击 “批量测试连接” 后，弹出进度弹窗（显示 “正在测试 xx 个环境连接...”+ 进度条），每个环境测试完成后更新进度条，全部完成后显示 “测试完成，xx 个成功，xx 个失败”，点击 “查看详情” 可展开失败环境列表（含失败原因）。

#### 9.2.2 新增执行任务页（核心操作页）

##### 1. 页面布局（分步骤表单）

采用 “步骤条” 形式拆分任务创建流程，降低用户操作复杂度，步骤间逻辑递进（前一步未完成不可进入下一步）。



| 步骤   | 步骤名称     | 核心元素                                                                                                      | 校验规则                                                                                  | 接口映射                                                                                                                          |
| ---- | -------- | --------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| 步骤 1 | 选择测试套与环境 | - 测试套选择（下拉框，可搜索，显示 “测试套名称（创建人）”）；- 环境选择（下拉框，仅展示 “可用” 状态环境，显示 “环境名称（类型）”）                                  | - 测试套必选（未选时提示 “请选择测试套”）；- 环境必选（未选时提示 “请选择可用环境”）                                       | - 测试套下拉数据→GET /api/v1/suite-management/suites（筛选 “可执行” 测试套）；- 环境下拉数据→GET /api/v1/env-management/environments?status=available |
| 步骤 2 | 配置执行包    | - 包类型选择（单选按钮：分支包 / 本地包）；- 分支包：分支下拉选择（可搜索，显示分支名称 + 最近更新时间）；- 本地包：文件上传框（支持拖拽上传，格式限制.tar/.gz，显示上传进度）、版本描述输入框 | - 分支包：分支必选（未选提示 “请选择分支”）；- 本地包：文件必传（未传提示 “请上传.tar/.gz 格式的包文件”）、版本描述必填（未填提示 “请输入版本描述”） | - 分支下拉数据→GET /api/v1/repo-management/branches（按代码仓获取分支列表）；- 本地包上传→POST /api/v1/file-management/upload（返回 file\_id，用于后续执行任务接口） |
| 步骤 3 | 选择执行方式   | - 执行方式选择（单选按钮：立即执行 / 定时执行）；- 定时执行：日期时间选择器（精确到分钟，默认当前时间 + 30 分钟，不可选择过去时间）                                  | - 定时执行：时间必选且需晚于当前时间（选择过去时间提示 “请选择未来的执行时间”）                                            | 无单独接口，参数随 “创建执行任务” 接口提交                                                                                                       |
| 步骤 4 | 确认任务信息   | - 任务信息汇总卡片（含测试套、环境、包信息、执行方式）；- “提交任务” 按钮（主色调）、“上一步” 按钮（次要色调）                                              | 无校验，仅展示前序步骤的已填信息，供用户确认                                                                | 提交任务→POST /api/v1/execution-management/tasks/immediate（立即执行）或 POST /api/v1/execution-management/tasks/scheduled（定时执行）         |

##### 2. 关键交互细节



* **步骤切换规则**：点击 “下一步” 时，先校验当前步骤表单，校验通过后进入下一步，步骤条对应步骤高亮；点击 “上一步” 直接返回上一步，保留已填数据；

* **分支包加载状态**：点击 “分支选择” 下拉框时，显示 “加载中...” 提示，接口请求超时（超过 10 秒）时显示 “分支加载失败，点击重试” 的重试按钮；

* **本地包上传限制**：上传文件超过 500MB 时，弹出提示 “单个包文件最大支持 500MB，请压缩后重新上传”；上传失败（如网络中断）时，显示 “上传失败，点击重试” 按钮，支持断点续传；

* **任务提交反馈**：点击 “提交任务” 后，显示 “任务创建中...” 的加载弹窗，创建成功后跳转至 “任务列表页” 并显示 “任务创建成功，任务 ID：xx” 的全局提示；创建失败（如环境被占用）时，弹窗显示失败原因（来自接口 “message” 字段），提供 “重试” 或 “取消” 按钮。

#### 9.2.3 任务结果详情页（核心结果页）

##### 1. 页面布局（分区域展示）



| 页面区域    | 元素组成                                                                       | 交互规则                                                                                                                        | 接口映射                                                                                                                                                   |
| ------- | -------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 任务基础信息区 | 卡片式布局，展示任务 ID、测试套名称（点击跳转至测试套详情）、环境名称（点击跳转至环境详情）、执行时间（开始 / 结束）、执行状态（标签）、执行人 | - 状态标签样式：成功（绿色）、失败（红色）、运行中（蓝色旋转动画）、已终止（灰色）；- 点击测试套 / 环境名称，新标签页打开对应详情页                                                      | GET /api/v1/execution-management/tasks/{task_id}（获取任务基础信息）                                                                                            |
| 结果统计区   | 3 个统计卡片（总用例数、成功用例数、失败用例数），卡片底部显示成功率（百分比，失败时显示失败率）                          | 卡片 hover 时轻微放大效果；成功卡片（绿色）、失败卡片（红色）、总用例卡片（灰色）                                                                                | 数据来自 “任务基础信息” 接口的 “total_case”“success_case”“failed_case” 字段                                                                                        |
| 用例结果列表区 | 表头（用例 ID、用例名称、特性名称、执行状态、执行时间、操作）、列表行（状态标签、失败原因 tooltip、标记按钮）               | - 状态筛选（顶部单选：全部 / 成功 / 失败 / 跳过）；- 失败用例：状态标签 hover 显示失败原因（来自用例结果表的 “log\_path” 解析）；- 操作列：失败用例显示 “标记” 按钮，点击弹出标记弹窗（选择状态 + 输入备注） | - 用例列表数据→GET /api/v1/result-management/tasks/{task_id}/cases（带状态筛选参数）；- 失败用例标记→PATCH /api/v1/result-management/tasks/{task_id}/cases/{case_id}/mark |
| 日志查看区   | “查看完整日志” 按钮（主色调）、日志弹窗（含日志内容（只读，支持搜索 / 复制）、日志导出按钮（PDF/CSV））                 | - 点击 “查看完整日志” 弹出日志弹窗，日志加载时显示 “加载中...”；- 日志搜索：支持关键词搜索，匹配内容高亮；- 导出日志：点击后调用导出接口，生成下载链接                                         | - 获取日志内容→GET /api/v1/result-management/tasks/{task_id}/log；- 导出日志→POST /api/v1/result-management/tasks/{task_id}/export-log                          |

### 9.3 页面交互通用规则

为保证系统交互的一致性，所有页面遵循统一的交互规范，包括提示样式、按钮状态、加载状态、异常处理等，提升用户体验。

#### 9.3.1 提示样式规范



| 提示类型   | 组件选择（Element Plus）                   | 显示位置   | 自动关闭  | 场景示例                              |
| ------ | ------------------------------------ | ------ | ----- | --------------------------------- |
| 成功提示   | Message.success                      | 页面顶部居中 | 3 秒   | 操作成功（如环境创建成功、任务提交成功）              |
| 误提示   | Message.error                        | 页面顶部居中 | 5 秒   | 操作失败（如环境删除失败、接口请求报错）              |
| 警告提示   | Message.warning                      | 页面顶部居中 | 4 秒   | 潜在风险（如选择 “终止任务” 时，提示 “任务终止后不可恢复”） |
| 信息提示   | [Message.info](https://Message.info) | 页面顶部居中 | 3 秒   | 普通信息（如 “日志导出已开始，将在完成后通知您”）        |
| 确认弹窗   | MessageBox.confirm                   | 页面居中   | 需手动关闭 | 危险操作确认（如删除环境、终止运行中任务）             |
| 详弹窗   | Dialog 组件                            | 页面居中   | 需手动关闭 | 查看日志详情、用例失败原因详情、操作日志详情            |
| 表单校验提示 | Form 组件内置校验提示                        | 表单字段下方 | 不自动关闭 | 字段未填、格式错误（如 IP 格式不正确、端口号非数字）      |

#### 9.3.2 按钮状态规范



| 按钮状态 | 样式规则                                       | 场景示例                 |
| ---- | ------------------------------------------ | -------------------- |
| 正常状态 | 主色调（#165DFF）背景，白色文字；hover 时背景色加深（#0E42D2）  | 主要操作按钮（新增、提交、保存、导出）  |
| 次要状态 | 白色背景，主色调文字，主色调边框；hover 时背景色变浅（#F0F5FF）     | 次要操作按钮（上一步、取消、重置、查看） |
| 禁用状态 | 灰色背景（#C9CDD4），白色文字；鼠标 hover 显示禁用原因 tooltip | 条件不满足的操作（如未          |


## 十、部署方案

### 10.1 部署架构

采用微服务架构部署，基于 Docker 容器化与 Kubernetes 编排，支持多环境（开发 / 测试 / 生产）隔离，部署架构如下：



```
客户端层 → CDN（静态资源加速） → 负载均衡器（Nginx） → API网关集群 → 微服务集群（任务管理、漏洞检测等） → 中间件集群（MySQL、Redis、MinIO）
```

### 10.2 环境配置



| 环境   | 服务器配置            | 部署规模                               | 用途         |
| ---- | ---------------- | ---------------------------------- | ---------- |
| 开发环境 | 4 核 8G 服务器 ×3    | 微服务单实例，中间件单节点                      | 功能开发与单元测试  |
| 测试环境 | 8 核 16G 服务器 ×5   | 微服务 2 实例，中间件主从架构                   | 集成测试与性能测试  |
| 生产环境 | 16 核 32G 服务器 ×10 | 微服务 3-5 实例（按负载动态调整），中间件集群（3 主 3 从） | 正式运行，支持高可用 |

### 10.3 部署流程



1. 开发人员提交代码至 Git 仓库，触发 Jenkins 流水线。

2. 流水线执行代码检查（SonarQube）、单元测试、打包构建（生成 Docker 镜像）。

3. 镜像推送至私有仓库（Harbor），并部署至测试环境，自动执行集成测试。

4. 测试通过后，手动审批部署至生产环境，Kubernetes 滚动更新服务（先启动新实例，再停止旧实例，确保零 downtime）。

5. 部署完成后，监控系统检查服务健康状态，若异常则自动回滚至前一版本。

## 十一、测试计划

### 11.1 测试类型与范围



| 测试类型  | 测试内容                               | 负责团队 | 验收标准                      |
| ----- | ---------------------------------- | ---- | ------------------------- |
| 单元测试  | 各模块核心函数（如任务调度算法、漏洞匹配逻辑）            | 开发团队 | 代码覆盖率≥80%，关键函数覆盖率 100%    |
| 集成测试  | 模块间接口调用（如任务管理→漏洞检测的初始化流程）、外部工具交互   | 测试团队 | 接口成功率 100%，数据流转无丢失        |
| 性能测试  | 并发任务处理（50 个任务同时运行）、漏洞检测响应时间、报表生成效率 | 测试团队 | 单任务响应时间≤100ms，CPU 使用率≤80% |
| 安全测试  | 接口渗透测试、数据加密验证、权限越界测试               | 安全团队 | 无高危漏洞，敏感数据加密合规            |
| 可靠性测试 | 系统连续运行 1000 小时，模拟硬件故障（如服务器宕机）      | 测试团队 | MTBF≥1000 小时，故障自动恢复成功     |

### 11.2 测试工具



* 单元测试：JUnit 5（Java）、PyTest（Python 脚本）

* 接口测试：Postman、JMeter

* 性能测试：JMeter、Gatling

* 安全测试：Nessus（漏洞扫描）、Burp Suite（渗透测试）

* 监控测试：Prometheus+Grafana（实时指标监控）

## 十二、维护与迭代计划

### 12.1 日常维护



1. **定期巡检**：每日检查系统日志、监控指标，每周生成维护报告，包含系统运行状态、潜在风险及优化建议。

2. **数据清理**：每月清理过期数据（如超过 1 年的原始采集数据），归档历史任务与报告至冷存储，释放存储空间。

3. **版本更新**：每季度进行一次小版本更新，修复已知 bug，优化性能；每年进行一次大版本更新，新增核心功能（如支持新芯片架构、AI 辅助漏洞检测）。

### 12.2 迭代路线图



| 版本   | 计划时间   | 核心功能                                    |
| ---- | ------ | --------------------------------------- |
| V1.0 | 3 个月后  | 基础任务管理、内置漏洞检测规则、简单防护策略、基础报表             |
| V1.5 | 6 个月后  | 自定义检测规则、插件化架构、高级可视化图表、多环境部署支持           |
| V2.0 | 12 个月后 | AI 辅助漏洞预测（基于历史数据训练模型）、跨芯片型号对比分析、分布式任务调度 |

## 十三、附录

### 13.1 术语定义



| 术语     | 定义                                      |
| ------ | --------------------------------------- |
| 芯片验证   | 通过模拟、仿真等手段，验证芯片设计是否满足功能、时序、功耗等需求的过程     |
| 漏洞检测规则 | 用于判断验证数据是否异常的条件集合（如信号电平超过阈值、时序违规）       |
| 防护策略   | 针对不同类型 / 严重程度的漏洞，预定义的自动响应动作（如暂停任务、发送告警） |
| 插件化架构  | 允许通过新增插件扩展系统功能，无需修改核心代码的设计模式            |

### 13.2 参考资料



1. 《芯片验证方法学》（Synopsys 官方文档）

2. 《微服务架构设计模式》（Chris Richardson）

3. 《数据库分库分表最佳实践》（MySQL 官方文档）

4. 《信息安全技术 数据加密规范》（GB/T 32927-2016）



***

本文档将根据需求变更与技术演进进行持续更新，修订记录见文档版本历史。

> （注：文档部分内容可能由 AI 生成）